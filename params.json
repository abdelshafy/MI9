{"name":"Mi9service","tagline":"mi9 service in C#   - Please also see https://github.com/mehdiromi/mi9client","body":"Welcome to mi9service \r\n=====================\r\n\r\n#### mi9service is written in C# using ASP.NET Web Api for mi9 coding challenge.\r\n\r\nThis repository contains 2 projects ( service and unit test). in addition to an example of service use and technical documents. \r\n\r\n* mi9service project\r\n\r\nmi9service is the actual implementation of the service as per specification on []()\r\nThe project is hosted on  AppHarbor in the following address and automatically gets updated with any changes to this Git repository.\r\nThe project is also automatically being compiled on a Continuous Integration server () and the following badge shows the live build status of the project including the unit test results.\r\n[![Build status](https://ci.appveyor.com/api/projects/status/lwu2aha3rmp44xqm)](https://ci.appveyor.com/project/mehdiromi/mi9service)\r\n[![Test Results](https://ci.appveyor.com/api/projects/status/lwu2aha3rmp44xqm)](https://ci.appveyor.com/project/mehdiromi/mi9service/build/tests)\r\n\r\n* mi9service.Test\r\n\r\nmi9service.Test is the unit test project for testing the service. The test result is available in the following address:\r\n[https://ci.appveyor.com/project/mehdiromi/mi9service/build/tests](https://ci.appveyor.com/project/mehdiromi/mi9service/build/tests)\r\n\r\n##### There is also a Node.js service developed for testing the service from another server. The Node.js project is located in a separate repository in the following URL:  [https://github.com/mehdiromi/mi9client](https://github.com/mehdiromi/mi9client)\r\nThe client is also hosted in Heroku in the following address:  [http://mi9client.herokuapp.com](http://mi9client.herokuapp.com).\r\nThe client is developed for the purpose of e2e testing the service using Node.js on Express, Jade and Jquery.\r\n\r\n## Service  address:\r\nThe service is hosted at appharbor.com in the following address:  [http://awesomeservice.apphb.com](http://awesomeservice.apphb.com).  The service automatically reads the githut repo and re-compile and deploy the project whenever there is any new commit.\r\n\r\n\r\n### How does the service work?\r\n\r\nThe service is web api controller that is only configured to accept requests from everywhere on the internet ( for the purposes of this exam) and allows Cross Origin resource sharing.\r\n\r\nThe controller is simply reads an input param mapped exactly to the sample JSON request and try pass it to `ShowsWithDrmAndAtleastOneEpisode` method to filter the inputs ( drm = true  and episodeCount > 0)  using LINQ and returns a new type with the valid data.\r\n\r\nThe application has 3 models for this project:  Error, Output, Show\r\n\r\n#### Error\r\nAs the error type to when it returns a bad request.\r\n\r\n```\r\n    /// <summary>\r\n    /// Error type for returning error as Http Response.\r\n    /// </summary>\r\n    public class Error\r\n    {\r\n        public string error { get; set; }\r\n    }\r\n```\r\n\r\n##### Output\r\nIs the valid output when application returns OK status code :\r\n```\r\n    /// <summary>\r\n    /// The response type. includes image, slug and title.\r\n    /// </summary>\r\n    public class Response\r\n    {\r\n        public string image { get; set; }\r\n        public string slug { get; set; }\r\n        public string title { get; set; }\r\n    }\r\n\r\n    /// <summary>\r\n    /// Wrapper for the Response\r\n    /// </summary>\r\n    public  class Output\r\n    {\r\n        public List<Response> response { get; set; }\r\n    }\r\n```\r\n\r\n##### Show\r\nThis is the request class containing a list of payloads:\r\n\r\n```\r\n    /// <summary>\r\n    /// Image type\r\n    /// </summary>\r\n    public class Image\r\n    {\r\n        public string showImage { get; set; }\r\n    }\r\n    /// <summary>\r\n    /// NextEpisode type\r\n    /// </summary>\r\n    public class NextEpisode\r\n    {\r\n        public object channel { get; set; }\r\n        public string channelLogo { get; set; }\r\n        public object date { get; set; }\r\n        public string html { get; set; }\r\n        public string url { get; set; }\r\n    }\r\n\r\n    /// <summary>\r\n    /// Season type used in Payload\r\n    /// </summary>\r\n    public class Season\r\n    {\r\n        public string slug { get; set; }\r\n    }\r\n\r\n    /// <summary>\r\n    /// The request payload type\r\n    /// </summary>\r\n    public class Payload\r\n    {\r\n        public string country { get; set; }\r\n        public string description { get; set; }\r\n        public bool drm { get; set; }\r\n        public int episodeCount { get; set; }\r\n        public string genre { get; set; }\r\n        public Image image { get; set; }\r\n        public string language { get; set; }\r\n        public NextEpisode nextEpisode { get; set; }\r\n        public string primaryColour { get; set; }\r\n        public List<Season> seasons { get; set; }\r\n        public string slug { get; set; }\r\n        public string title { get; set; }\r\n        public string tvChannel { get; set; }\r\n    }\r\n\r\n    /// <summary>\r\n    /// The input show \r\n    /// </summary>\r\n    public class Show\r\n    {\r\n        public List<Payload> payload { get; set; }\r\n        public int skip { get; set; }\r\n        public int take { get; set; }\r\n        public int totalRecords { get; set; }\r\n    }\r\n```\r\n\r\n#### Exception handling\r\nIf there is an exception in mapping the JSON to C# class or invalid data,  the controller returns an Error type :\r\n\r\n```\r\n return Request.CreateResponse<Error>(HttpStatusCode.BadRequest, new Error {\r\n                    error = \"Could not decode request: JSON parsing failed\"\r\n                });\r\n\t\t\t\t\r\n\t\t\t\t\r\n```\r\n\r\n\r\nIf everything is ok, the controller returns OK response as below:\r\n\r\n```\r\n return Request.CreateResponse<Output>(HttpStatusCode.OK, \r\n\tShowsWithDrmAndAtleastOneEpisode(input)\r\n\t);\r\n```\r\n\r\nThe actual implementation of the controller :\r\n \r\n```\r\n   /// <summary>\r\n    /// ServiceController is the main Web API for the coding challenge.\r\n    /// This Web Api is served on the root path of the service and is an standalone service.\r\n    /// For this exercise, access from all origins with all REST verbs is allowed however the service only implements POST.\r\n    /// </summary>\r\n    [EnableCors(origins: \"*\", headers: \"*\", methods: \"*\")]\r\n    public class ServiceController : ApiController\r\n    {\r\n        /// <summary>\r\n        /// Post action method receives a HttpRequestMessage with a content of type Show and returns HttpResponseMessage with of type Response.\r\n        /// </summary>\r\n        /// <param name=\"input\">JSON input of the type show</param>\r\n        /// <returns>HttpResponseMesage with Response or Error types</returns>\r\n        [HttpPost]\r\n        public HttpResponseMessage Post(Show input)\r\n        {\r\n            if (input == null)\r\n            {\r\n                return Request.CreateResponse<Error>(HttpStatusCode.BadRequest, \r\n\t\t\t\t\tnew Error {\r\n\t\t\t\t\t\terror = \"Could not decode request: JSON parsing failed\"\r\n                });\r\n            }\r\n            try\r\n            {\r\n                return Request.CreateResponse<Output>(HttpStatusCode.OK, \r\n\t\t\t\t\tShowsWithDrmAndAtleastOneEpisode(input));\r\n            }\r\n            catch (Exception ex)\r\n            {\r\n                return Request.CreateResponse<Error>(HttpStatusCode.BadRequest, \r\n\t\t\t\t\tnew Error {\r\n\t\t\t\t\t\terror = \"Could not decode request: \" + ex.Message\r\n                });\r\n            }\r\n        }\r\n\r\n        /// <summary>\r\n        /// The cofing challenge logic is implemented in this method.\r\n        /// This method uses LINQ to Object to filter the shows with DRM true and episodeCount > 0\r\n        /// </summary>\r\n        /// <param name=\"input\">A de-serialized object of shows  equivalent to the input JSON.</param>\r\n        /// <returns>An object of type Output with a property of response of image, slug and title fields from the input.</returns>\r\n        private Output ShowsWithDrmAndAtleastOneEpisode(Show input)\r\n        {\r\n            var data = (from p in input.payload\r\n                            where\r\n                                p.drm &&\r\n                                p.episodeCount > 0\r\n                            select new Response\r\n                            {\r\n                                image = p.image.showImage,\r\n                                slug = p.slug,\r\n                                title = p.title\r\n                            }\r\n                        ).ToList();\r\n            return new Output\r\n            {\r\n                response = data\r\n            };\r\n        }\r\n       \r\n    }\r\n```\r\n\r\n#### Routing \r\nThe default routing is changed to redirect all requests to the root of the service \r\n\r\n```\r\npublic static class WebApiConfig\r\n    {\r\n        /// <summary>\r\n        /// Registers the configuration\r\n        /// Here Cross-origin resource sharing needs to be enabled.\r\n        /// Default routing to the API is also configured here.\r\n        /// </summary>\r\n        /// <param name=\"config\">HttpConfiguration</param>\r\n        public static void Register(HttpConfiguration config)\r\n        {\r\n            //Cross-origin resource sharing \r\n            config.EnableCors();\r\n            \r\n            //Default Routing\r\n            config.MapHttpAttributeRoutes();\r\n            config.Routes.MapHttpRoute(\r\n                name: \"DefaultApi\",\r\n                routeTemplate: \"{controller}/{id}\",\r\n                defaults: new { controller = \"service\", \r\n\t\t\t\t\t\tid = RouteParameter.Optional }\r\n            );\r\n        }\r\n    }\r\n```\r\n\r\n#### Installation\r\n * If you are hosting on AppHarbor.com, just clone this repository and the appharbor will look after everything else.\r\n * If you building on the cloud services such as Appveyor or Azure, In the setting > build > Before build script,  add the following `nuget restore` so the build service will restore all necessary packages.\r\n * On local machine, please clone the repository and open the solution with visual studio and build. the solution is configured to automatically download all required packages\r\n\r\n\r\n#### Technical documentation\r\n There is a technical documentation is automatically generated from the comments in the project by free tools [http://sandcastle.codeplex.com/](http://sandcastle.codeplex.com/).\r\n The document is in html format and is available in [https://github.com/mehdiromi/mi9service/tree/master/TechnicalDocument/Help](https://github.com/mehdiromi/mi9service/tree/master/TechnicalDocument/Help)\r\n\r\nThis application is written by Mehdi Romi (mehdi.romi@gmail.com) and uses free resources for development and hosting.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}